<!DOCTYPE html>
<html>
<head>
<title>修改收货信息 - 萌多多私宠会馆 - 五公里免费上门 </title>
<!-- for-mobile-apps -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false);
		function hideURLbar(){ window.scrollTo(0,1); } </script>
<!-- //for-mobile-apps -->
<link href="css/bootstrap.css" rel="stylesheet" type="text/css" media="all" />
<link href="css/style.css" rel="stylesheet" type="text/css" media="all" />
<!-- js -->
<script src="js/jquery-1.11.1.min.js"></script>
<!-- //js -->
<!-- start-smoth-scrolling -->
<script type="text/javascript" src="js/move-top.js"></script>
<script type="text/javascript" src="js/easing.js"></script>
<script type="text/javascript">
	jQuery(document).ready(function($) {
		$(".scroll").click(function(event){		
			event.preventDefault();
			$('html,body').animate({scrollTop:$(this.hash).offset().top},1000);
		});
	});
</script>
<!-- start-smoth-scrolling -->
<!-- start menu -->
<link href="css/megamenu.css" rel="stylesheet" type="text/css" media="all" />
<script type="text/javascript" src="js/megamenu.js"></script>
<script>$(document).ready(function(){$(".megamenu").megamenu();});</script>
<script src="js/menu_jquery.js"></script>
<script src="js/simpleCart.min.js"> </script>

<script>
	
	var token = localStorage.getItem("smart_token");
	var userAddrs = [];
	
	if(token == "ssp" || token == null || token.length < 10){
		location.href="login.html";
	}
	
	$(document).ready(function(){
		get_user_orders();
	});
	
	
	function save_user_addrs(addrid,num){
		var caddr1 = (num == 0)?addrid:0;
		var caddr2 = (num == 1)?addrid:0;
		var caddr3 = (num == 2)?addrid:0;
		var caddr4 = (num == 3)?addrid:0;
		var a = "/api/delivery?action=user_set_addrs&addr1="+caddr1+"&addr2="+caddr2+"&addr3="+caddr3+"&addr4="+caddr4+"&token="+token;
		$.ajax(
			{ url:a }
		).fail(
			function(obj,n){
				// 失败时执行
				alert("失败了" + obj + n);
			}
		).done(
			function(obj,n){
				// 成功时执行
				console.log(obj);
				var c = JSON.parse(obj);
				if(c.code == 1000){
					console.log(c);
					alert("保存成功！");
					if(GetQueryString("goback") != null){
						location.href=GetQueryString("goback");
					}
				}else{
					alert(c.msg);
				}
		});
	}
	
	function save_addr(){
		// 保存当前的地址，并且要把地址保存到用户的指定地址中去
		var cty = $("#city").val();
		var cphone = $("#in_phone").val();
		var caddr = encodeURI($("#in_addr").val());
		var crsv = encodeURI($("#in_rsver").val());
		var a = "/api/delivery?action=address_set&dst="+0+"&prv="+0+"&city="+cty+"&addr="+caddr+"&rsver="+crsv+"&phone="+cphone+"&token="+token;
		$.ajax(
			{ url:a ,k:nowAddrId}
		).fail(
			function(obj,n){
				// 失败时执行
				alert("失败了" + obj + n);
			}
		).done(
			function(obj,n){
				// 成功时执行
				console.log(obj);
				var c = JSON.parse(obj);
				if(c.code == 1000){
					console.log(c);
					save_user_addrs(c.addrid,this.k)				
				}else{
					if(c.code == -1015){
						location.href="login.html?goto=address.html";
					}
					alert(c.msg);
				}
			}
		);
	}
	
	// 下面这个变量实际上是改地址在用户地址列表中的顺序
	var nowAddrId = 0;
	function showByAddr(ad){
		if(ad.city == 1){
			$("#pls_futian").attr("selected","true");
		}else{
			$("#pls_autre").attr("selected","true");
		}
		$("#in_rsver").val(decodeURI(ad.rsvr));
		$("#in_phone").val(ad.mobile);
		$("#in_addr").val(decodeURI(ad.addr));
	}
	
	function moveTo(num){
		nowAddrId = num;
		show_order(userAddrs[num]);
	}
	
	function show_order(v){
		
		$("#saverbtn").val("保存地址-" + (nowAddrId+1));
		
		if(v == 0){ /* 并没有任何的地址 */
			return;
		}
		
		var a = "/api/delivery?action=address_get&addrid="+v+"&token="+token;
		$.ajax(
			{ url:a }
		).fail(
			function(obj,n){
				// 失败时执行
				alert("失败了" + obj + n);
			}
		).done(
			function(obj,n){
				// 成功时执行
				console.log(obj);
				var c = JSON.parse(obj);
				if(c.code == 1000){
					console.log(c);
					var addr = c.addr;
					showByAddr(addr);
				}else{
					if(c.code == -1015){
						location.href="login.html?goto=address.html";
					}
					alert(c.msg);
				}
			}
		);
	}
	
	function get_user_orders(){
		var a = "/api/delivery?action=user_addrs&token="+token;
		$.ajax(
			{ url:a }
		).fail(
			function(obj,n){
				// 失败时执行
				alert("失败了" + obj + n);
			}
		).done(
			function(obj,n){
				// 成功时执行
				console.log(obj);
				var c = JSON.parse(obj);
				if(c.code == 1000){
					console.log(c);
					userAddrs.push(c.addr1);
					userAddrs.push(c.addr2);
					userAddrs.push(c.addr3);
					userAddrs.push(c.addr4);
					nowAddrId = 0;
					show_order(c.addr1);
				}else{
					if(c.code == -7003){
						// 没有任何id
						userAddrs.push(0);
						userAddrs.push(0);
						userAddrs.push(0);
						userAddrs.push(0);
						nowAddrId = 0;
						show_order(0);
					}else{
						if(c.code == -1015){
							location.href="login.html?goto=address.html";
						}
						alert(c.msg);
					}
				}
			}
		);
	}
	
</script>
</head>
	
<body>
<!-- header -->
	<script>show_top_header();</script>
<!-- check-out -->
<div class="login">
	<div class="container">
		<div class="login-grids">
			<div class="col-md-6 log">
					 <h3 id="addr_title">收货地址</h3>
					 <div class="strip"></div>
					 <form onsubmit="return false;">
						 <br>	
						 <input type="text" id="in_rsver" placeholder="  收货人  " />
						 <br>
						 <input type="text" id="in_phone" placeholder="  手机号  " />
						 <br><span style="margin-left: 10px">地区：</span>
						<select name="city" id="city" class="arrival">
							<option value="1" id="pls_futian">深圳福田</option>
							<option value="2" id="pls_autre">其他地区</option>
						</select>
						 <br>
						 <br>
						 <input type="text" id="in_addr" placeholder="  地址  " />	
						 <br>				
						 <input type="submit" value="保存地址-1" id="saverbtn" onclick="save_addr()" />
					 </form>
			</div>
			<div class="col-md-6 login-right">
			  <h3>用户的收货地址列表</h3>
			  <div class="strip"></div>
			  <p>默认地址 ( 1 )</p>
			  <a class="button" onclick="moveTo(0)">编辑此地址</a>
			  <p>地址 ( 2 )</p>
			  <a class="button" onclick="moveTo(1)">编辑此地址</a>
			  <p>地址 ( 3 )</p>
			  <a class="button" onclick="moveTo(2)">编辑此地址</a>
			  <p>地址 ( 4 )</p>
			  <a class="button" onclick="moveTo(3)">编辑此地址</a>
			</div>
			<div class="clearfix"></div>
		</div>
	</div>
</div>
<!-- //check-out -->
<!-- footer -->
<script>smart_showfooter();</script>
<!-- //footer -->
</body>
</html>