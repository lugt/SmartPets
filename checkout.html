<!DOCTYPE html>
<html>
<head>
<title>购物车 - 萌多多私宠会馆 - 在线下单 - 5公里送货上门</title>
<!-- for-mobile-apps -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="application/x-javascript"> 
	addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false);
	function hideURLbar(){ window.scrollTo(0,1); } </script>
<!-- //for-mobile-apps -->
<link href="css/bootstrap.css" rel="stylesheet" type="text/css" media="all" />
<link href="css/style.css" rel="stylesheet" type="text/css" media="all" />
<!-- js -->
<script src="js/jquery-1.11.1.min.js"></script>
<!-- //js -->
<!-- start-smoth-scrolling -->
<script type="text/javascript" src="js/move-top.js"></script>
<script type="text/javascript" src="js/easing.js"></script>
<script type="text/javascript">
	jQuery(document).ready(function($) {
		$(".scroll").click(function(event){		
			event.preventDefault();
			$('html,body').animate({scrollTop:$(this.hash).offset().top},1000);
		});
	});
</script>
<!-- start-smoth-scrolling -->
<!-- start menu -->
<link href="css/megamenu.css" rel="stylesheet" type="text/css" media="all" />
<script type="text/javascript" src="js/megamenu.js"></script>
<script>$(document).ready(function(){$(".megamenu").megamenu();});</script>
<script src="js/menu_jquery.js"></script>
<script src="js/simpleCart.min.js"> </script>
</head>
<body>
<!-- header -->
<script>show_top_header();</script>
<!-- //logo-cart -->
<!-- check-out -->
<div class="container">
	<div class="check">	 
	
		<div class="col-md-9 cart-items" id="cart-mm-items">
			<h1>购物车</h1>
		</div>
		<div class="col-md-3 cart-total" style="font-size:1.2em">
			<div class="simpleCart_itemss"></div>
  			<a class="continue" href="#">收货地址</a>
			<div class="price-details">
				<p><a href="address.html">修改收货地址</a></p>
				<p> 网某某 188****5552 广东省深圳市南山区昂周路92号C座快递柜</p>
			</div>            
			<a class="continue" href="#">订单信息</a>
   			<div class="price-details">
			<h3>价格详情</h3>
			<span>商品价格</span>
			<span class="total1" id="productprice">62.00 ￥</span>
			<span>优惠</span>
			<span class="total1" id="promotions">- 0.2￥</span>
			<span class="total1">优惠额度</span>
			<span>下单后可见</span>
			<span>物流费用</span>
			<span class="total1" id="deliveryfee"></span>
			<div class="clearfix"></div>				 
			</div>	
			<ul class="total_price">
			   <li class="last_price"> <h4>商品总计</h4></li>	
			   <li class="last_price" id="counted_price"><span>61.50</span></li>
			   <div class="clearfix"> </div>
			</ul> 
			<div class="clearfix"></div>
			<a class="order" id="press_order" href="#" onclick="doCheckout()">提交订单</a>
			<!--div class="total-item">
				<h3>选择</h3>
				<h4>优惠券</h4>
				<a class="cpns" href="#">获得优惠券</a>
			</div-->
		</div>
        <script>
		var sumOfMoney = 0.0;
		var token = localStorage.getItem("smart_token");
		if(token == "ssp"){
			location.href="login.html";
		}
		function doCheckout(){
			var goods = simpleCart.find();
			var len = goods.length;
			var data = [];
			for(i=0;i<len;i++){
				data.push({q:goods[i].fields().quantity,model:1,id:goods[i].fields().id});
			}
			if(sumOfMoney <= 0.01){
				alert("请先选购商品哦");
				return false;
			}
			var url = '/api/orders?action=create&token='+token+'&payment=2&delivery=2&addr=2&products=' + encodeURI(JSON.stringify(data));
			$.ajax({url:url}).done(function(obj,s){
				// OK				
				console.log(obj);
				var c = JSON.parse(obj);
				if(c.code == 1000){
					location.href="order.html?id="+c.order;
				}else{
					if(c.code == -1015){
						location.href="login.html?goto=checkout.html";
					}
					alert(c.msg);
				}
			}).fail(function (obj,s){
				alert("下单失败，请稍候再试");
			});
		}
		simpleCart.ready( function(){
			addThis();
		});
		function addThis(){
			var goods = simpleCart.find();
			var len = goods.length;
			var i = 1;
			var innerT = "";
			for(i=0;i<len;i++){
					var price = goods[i].fields().price;
					var cquant = goods[i].fields().quantity;
					sumOfMoney += cquant * price;
					var cname = (goods[i].fields().name == undefined)?"商品A":goods[i].fields().name;
					var cimg = (goods[i].fields().img == undefined)?"images/123.jpg":goods[i].fields().img;
					innerT += '<div class="cart-header">'+
				'<div class="close'+i+'" onclick="rmvProduct('+i+')"> </div>'+
				'<div class="cart-sec simpleCart_shelfItem">' +
'						<div class="cart-item cyc">'+
'							<img src="'+cimg+'" class="img-responsive" alt="" id="cart-item-pic-'+i+'"/>'+
'						</div>'+
'                           <h3>'+cname+'</h3>'+
'					   <div class="cart-item-info">'+
'							<ul class="qty">'+
'								<li><p>数量 : '+cquant+'</p></li>'+
'							</ul>'+
'							<div class="delivery">'+
'								 <span>下单后立即发货</span>'+
'								 <div class="clearfix"></div>'+
'							</div>	'+
'							<div class="fgh">'+
'								<a href="single.html?id='+goods[i].fields().id+'">查看商品</a>'+
'							</div>'+
'					   </div>'+
'					   <div class="clearfix"></div>											'+
'				  </div>'+
'			 </div>';
			}
			if(innerT == "" || innerT == null){
				innerT = "<p>还没有商品哦</p><p> <a href='index.html#recommends'>立即去选购商品吧</a>！</p><br><br>"
			}
			innerT = $("#cart-mm-items").html() + innerT;
			$("#cart-mm-items").html(innerT);
			$("#productprice").html(sumOfMoney.toFixed(2)+" ￥");
			$("#promotions").html("<b style='color:#AC9D5D'>金卡立减</b>");			
			$("#deliveryfee").html(parseInt("0").toFixed(2)+"  ￥");	
			$("#counted_price").html("<span>"+sumOfMoney.toFixed(2)+" ￥</span>");
			if(sumOfMoney <= 0.01){
				$("#press_order").hide();
			}
		}
		function rmvProduct(i){
					// 删除Cart数据
					// 删除div
					$('.cart-header').fadeOut('slow', function(c){
						$('.cart-header').remove();
					});
		}
		</script>
		<div class="clearfix"> </div>
	</div>
</div>
<!-- //check-out -->
<!-- footer -->
<script> smart_showfooter(); </script>
<!-- //footer -->
</body>
</html>